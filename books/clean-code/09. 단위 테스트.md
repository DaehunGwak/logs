# 09. 단위 테스트

> 이때까지 정리만 한 것 같다.
> 다음과 같은 내용이 담기도록 수정해보자
>
> - 나의 실천 전략
> - 요약 정리는 당연
> - 나의 생각 / 의견

- [09. 단위 테스트](#09-단위-테스트)
  - [실천 전략](#실천-전략)
  - [요약 정리 & 생각](#요약-정리--생각)
    - [TDD 법칙 세가지](#tdd-법칙-세가지)
    - [깨끗한 테스트 코드 유지하기](#깨끗한-테스트-코드-유지하기)
    - [깨끗한 테스트 코드](#깨끗한-테스트-코드)
    - [테스트 당 assert 하나](#테스트-당-assert-하나)
    - [F.I.R.S.T.](#first)
  - [공부거리](#공부거리)

## 실천 전략

- 가독성은 매우 중요!
- [Build-Operate-Check 패턴](http://www.shino.de/2009/12/20/patterns-for-test-automation/)을 이용
- 테스트 함수마다 한 개념만 테스트
- 테스트당 하나의 assert를 지향, 오버 엔지니어링이라 판단될 경우 줄이는 것을 고민

## 요약 정리 & 생각

### TDD 법칙 세가지

1. 실패하는 단위 테스트를 작성할 때 까지 실제 코드를 작성하지 않는다
1. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위테스트를 작성한다.
1. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

이렇게 하면 실제 코드를 사실상 전부 테스트하는 방대한 코드가 나와 관리 문제를 유발하기도 함

### 깨끗한 테스트 코드 유지하기

> 테스트 코드는 실제 코드 못지 않게 중요하다

- 테스트는 유연성, 유지보수성, 재사용성을 제공한다.
  - 코드를 유연하게 만드는 `버팀목` 이 바로 단위 테스트
- 테스트 케이스가 변경을 쉽게 만듦
  - 실제 코드를 점검하는 자동화된 단위 테스트 슈트를 만드는게 좋음

### 깨끗한 테스트 코드

- 깨끗한 테스트 코드를 만들려면? 세 가지가 필요
  - 가독성
  - 가독성
  - 가독성 🧐
- `BUILD-OPERATE-CHECK 패턴` 을 이용하자
  - 자료를 만들고
  - 이를 조작하여
  - 올바른지 확인
- 도메인에 특화된 테스트 언어
  - 테스트에 필요한 wrapping 함수와 유틸리티를 구현한 후 사용하여 가독성을 증가
- 이중 표준
  - 실제 표준 vs 테스트 API 적용 표준 다름..
  - 테스트는 실제 코드만큼 효율적인 필요는 없음

> 사실 여기에서 나오는 예제 9-3 -> 9-4 를 봤을 때 옳은 개선이라고 동의하긴 어렵다. (에어컨 상태를 `HBchL` 이런식으로 대문자 소문자 축약을 사용) 처음 테스트 코드를 보는 사람은 해당 지식이 없으면 보기 불편할 것 같다. 하지만 해당 지식을 한 번 익히기 시작하면 코드 간결성과 빠른 이해를 불러오는 데에는 동의한다.

### 테스트 당 assert 하나

- given-when-then 관례 사용
  - build-operate-check 패턴과 차이가 뭐지?
    - build-operate-check 패턴 은 given-when-then 의 일반화 된 패턴
    - 4개의 스텝으로 구성
      - setup or build
      - execute or opreate
      - verify or check
      - optional teardown
    - ref: http://www.shino.de/2009/12/20/patterns-for-test-automation/
- template method 패턴으로 중복 제거 가능
  - 오버 엔지니어링 일 수도 있음
- 테스트당 하나의 assert를 지향하지만, 때에 따라 여럿으로 작성하는 것도 가능
  - 최대한 줄이는 방향으로 가는 것으로~
- **테스트당 개념 하나**

### F.I.R.S.T.

> 깨끗한 테스트의 5 원칙

- Fast: 테스트는 빨라야 한다
- Indenpendent: 각 테스트는 서로 의존하면 안된다
- Repeatable: 어떤 환경에서도 반복 가능해야 함
- Self-Validating: 성공 or 실패
- Timely: 테스트 하려는 실제 코드를 구현하기 직전에 구현

## 공부거리

- django test 코드를 어떻게 짜는지 공부해야겠다는 생각이 들었음
  - django test 코드 공부 링크
    - https://docs.djangoproject.com/en/3.0/topics/testing/
    - https://www.django-rest-framework.org/api-guide/testing/
    - https://www.udemy.com/course/django-python-advanced/ 
